# 06 - Web Scraping in Ruby

## Lesson Objectives

After this training stage the trainee should be able to:

+ Use the `RestClient` service to perform a GET request and retrieve a website's markup.
+ Understand what the HTML DOM (Document Object Model) is and how to model it through the `nokogiri` gem into a ruby object based on retrieved html markup.
+ Use the `Nokogiri::HTML` module to traverse and scrape the DOM to suit their needs and extract the desired information.

## Lesson

This lesson consists of a detailed exploration of the Ruby syntax and conventions that exist for web scraping activities.

+ Introduce the concept of web scraping and the HTML DOM, as well as some of their use cases.
+ Review the `rest-client` gem and the `RestClient.get` method
+ Introduce the `nokogiri` gem and the `Nokogiri::HTML` module.
+ Explain the  `css` property of the DOM Nokogiri object and how it retuns iterable collections of html elements that match the `html tag`, `css class`, or `unique id` sent as a parameter.
+ Demonstrate how to iterate and parse said HTML element collections into text or Ruby objects that can be used and easily manipulated in the script.

The [lesson.rb](lesson.rb) file in this directory contains commented code examples for all of these concepts.

## Practice

In order to complete this practice exercise, checkout the [practice.rb](practice.rb) file for the exercise template. This practice is a two-part exercise.

The following gems are used in these practice exercises:

+ [csv](https://github.com/ruby/csv)
+ [rest-client](https://github.com/rest-client/rest-client)
+ [nokogiri](https://github.com/sparklemotion/nokogiri)

Each trainee will practice the previously covered theory by writing a Ruby script according to the following instructions/requirements:

### Exercise One

Refactor the lesson.rb code to use Ruby classes and objects instead of hashes and process some
of the scraped data to calculate some relevant figures.

1. Copy-paste the lesson.rb code (you may add a Gemfile and remove the 'require's) into a new file called `scrape_rottent_tomatoes.rb`
2. Refactor the existing code by adding the necessary classes to hold the scraped data and fill the 'movies' array with objects instead of hashes (please use as many new files as needed to keep the classes in their own files).
3. In the `scrape_rotten_tomatoes.rb` script, get and report the **total sales generated by all the movies** by using methods that you write for the classes you are using.
4. In the same script and also using methods from your custom classes, get and report the **average movie score**.

### Exercise Two

Scrape the [Hacker News](https://news.ycombinator.com) website and model the necessary classes to be able to show only the most relevant data to a user.

1. Use a class to represent the scraping client (you may call it Scraper or ScrapingClient for simplicity). Ideally this class should not be instantiated (figure out what that means in terms of the method types and how you should call them).
2. Use a class to represent the independent article or story, storing only the information YOU would like to keep from what is shown on the front page ONLY.
3. Use any other classes you think may be useful to represent some of the more complex dependencies that will be aggregated to the article or story class above (in other words, the compound attributes of the article/story class).
4. Write a script (`hacker_news_scraper.rb`) that uses the Scraper to read HTML from [Hacker News](https://news.ycombinator.com) and parse it into instances of your custom class and then reports the top 15 stories into a CSV file (with headings).

## Self Study

+ [Distilled - Web Scraping with Ruby and Nokogiri for Beginners](https://www.distilled.net/nokogiri-and-ruby-web-scraping/)
+ [Upwork - What is Web Scraping and How Can You Use it?](https://www.upwork.com/hiring/for-clients/web-scraping-tutorial/)

Complete the following sections of the [Codecademy Learn Ruby course](https://www.codecademy.com/courses/learn-ruby):

## Useful Links

+ [Nokogiri RDoc](https://nokogiri.org/rdoc/index.html)
+ [RubyDoc - CSV Module](http://ruby-doc.org/stdlib-1.9.2/libdoc/csv/rdoc/CSV.html)
+ [Linda Vivah - THE BEGINNER'S GUIDE: Scraping in Ruby Cheat Sheet](https://medium.com/@LindaVivah/the-beginner-s-guide-scraping-in-ruby-cheat-sheet-c4f9c26d1b8c)
+ [Icalia Labs Internal Ruby Guides](https://github.com/IcaliaLabs/guides/tree/master/stack/ruby)
+ [Ruby Guides](https://www.rubyguides.com/)